{% extends 'JLTsite/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Dashboard Chef {{ department_name }} - Julien-Leblanc Traiteur{% endblock %}

{% block extra_css %}
<style>
    /* Variables CSS pour chef de d√©partement */
    :root {
        --dept-primary: #4682B4;
        --dept-primary-hover: #5F9EA0;
        --dept-secondary: #B0E0E6;
        --dept-accent: #1E90FF;
        --dept-dark: #2F4F4F;
        --dept-light: #F0F8FF;
        --dept-gray: #6c757d;
        --dept-gray-light: #e9ecef;
        --dept-white: #ffffff;
        --dept-success: #20B2AA;
        --dept-warning: #FFD700;
        --dept-danger: #DC143C;
    }

    /* Header */
    .dept-header {
        background: linear-gradient(135deg, var(--dept-primary) 0%, var(--dept-dark) 100%);
        padding: 2rem 0;
        position: relative;
        overflow: hidden;
    }
    
    .dept-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 60%;
        height: 200%;
        background: radial-gradient(circle, rgba(30, 144, 255, 0.1) 0%, transparent 70%);
        animation: float 20s ease-in-out infinite;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
    }
    
    .dept-title {
        color: white;
        font-size: 2rem;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .dept-badge {
        background: var(--dept-accent);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .dept-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
        position: relative;
        z-index: 1;
    }
    
    /* Navigation */
    .dept-nav {
        background: var(--dept-dark);
        border-bottom: 3px solid var(--dept-accent);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .dept-nav-tabs {
        display: flex;
        gap: 0;
        margin: 0;
        padding: 0;
        overflow-x: auto;
    }
    
    .dept-nav-tab {
        padding: 1rem 1.5rem;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        border-bottom: 3px solid transparent;
        position: relative;
    }
    
    .dept-nav-tab:hover {
        background: rgba(255, 255, 255, 0.05);
        color: white;
    }
    
    .dept-nav-tab.active {
        background: rgba(30, 144, 255, 0.1);
        color: var(--dept-accent);
        border-bottom-color: var(--dept-accent);
    }
    
    .nav-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--dept-danger);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-5px); }
        60% { transform: translateY(-3px); }
    }
    
    /* Content */
    .dept-content {
        background: var(--dept-light);
        padding: 2rem 0;
        min-height: calc(100vh - 300px);
    }
    
    /* Date Selector */
    .date-selector-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        border-top: 4px solid var(--dept-accent);
    }
    
    .date-selector-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .date-selector-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--dept-dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .date-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .date-input {
        padding: 10px 15px;
        border: 2px solid var(--dept-gray-light);
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
    }
    
    .date-input:focus {
        outline: none;
        border-color: var(--dept-accent);
        box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.1);
    }
    
    .date-btn {
        padding: 10px 15px;
        background: var(--dept-accent);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .date-btn:hover {
        background: var(--dept-primary-hover);
        transform: translateY(-2px);
    }
    
    .date-btn.secondary {
        background: var(--dept-gray);
    }
    
    .date-btn.secondary:hover {
        background: var(--dept-dark);
    }
    
    .date-indicator {
        background: var(--dept-success);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .date-indicator.past {
        background: var(--dept-gray);
    }
    
    .date-indicator.future {
        background: var(--dept-warning);
        color: var(--dept-dark);
    }
    
    /* Department Info Card */
    .dept-info-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        border-top: 4px solid var(--dept-accent);
    }
    
    .dept-info-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .dept-info-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--dept-dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .today-date {
        background: var(--dept-accent);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }
    
    /* Statistics Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 3px 15px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        text-align: center;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--dept-accent);
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }
    
    .stat-icon {
        width: 60px;
        height: 60px;
        background: var(--dept-light);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        color: var(--dept-accent);
        margin: 0 auto 1rem;
    }
    
    .stat-value {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--dept-dark);
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: var(--dept-gray);
        font-size: 0.95rem;
        font-weight: 500;
    }
    
    /* Production Progress */
    .production-progress {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    
    .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .progress-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--dept-dark);
    }
    
    .progress-percentage {
        font-size: 2rem;
        font-weight: 700;
        color: var(--dept-primary);
    }
    
    .progress-bar {
        width: 100%;
        height: 20px;
        background: var(--dept-gray-light);
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 1rem;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--dept-accent) 0%, var(--dept-primary) 100%);
        transition: width 0.5s ease;
        border-radius: 10px;
    }
    
    .progress-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .progress-item {
        text-align: center;
        padding: 1rem;
        background: var(--dept-light);
        border-radius: 8px;
    }
    
    .progress-item-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--dept-primary);
        margin-bottom: 0.25rem;
    }
    
    .progress-item-label {
        font-size: 0.85rem;
        color: var(--dept-gray);
        font-weight: 500;
    }
    
    /* Quick Actions */
    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .quick-action {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        text-decoration: none;
        color: var(--dept-dark);
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        border: 2px solid transparent;
    }
    
    .quick-action:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        border-color: var(--dept-accent);
    }
    
    .quick-action-icon {
        width: 50px;
        height: 50px;
        background: var(--dept-accent);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        font-size: 1.3rem;
        color: white;
    }
    
    .quick-action-title {
        font-weight: 600;
        font-size: 0.95rem;
    }
    
    /* Notifications */
    .notifications-section {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }
    
    .notifications-header {
        background: linear-gradient(135deg, var(--dept-light) 0%, #f8f9fa 100%);
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--dept-gray-light);
    }
    
    .notifications-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--dept-dark);
    }
    
    .notification-item {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--dept-gray-light);
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
    }
    
    .notification-item:hover {
        background: var(--dept-light);
    }
    
    .notification-item:last-child {
        border-bottom: none;
    }
    
    .notification-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        color: var(--dept-accent);
        background: var(--dept-light);
    }
    
    .notification-content {
        flex: 1;
    }
    
    .notification-title {
        font-weight: 600;
        color: var(--dept-dark);
        margin-bottom: 0.25rem;
    }
    
    .notification-message {
        font-size: 0.9rem;
        color: var(--dept-gray);
        margin-bottom: 0.25rem;
    }
    
    .notification-time {
        font-size: 0.8rem;
        color: var(--dept-gray);
    }
    /* √âtats des notifications */
.notification-item {
    cursor: pointer;
    position: relative;
}

.notification-item.read {
    opacity: 0.7;
}

.notification-item.read .notification-title {
    font-weight: 500;
}

.notification-item:hover {
    background: var(--dept-light);
    transform: translateX(5px);
}

.notification-badge {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(220, 20, 60, 0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(220, 20, 60, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(220, 20, 60, 0);
    }
}
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--dept-gray);
    }
    
    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
        color: var(--dept-accent);
    }
    
    .empty-state-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--dept-dark);
    }
    
    .empty-state-text {
        font-size: 1.1rem;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .dept-nav-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .progress-details {
            grid-template-columns: 1fr;
        }
        
        .quick-actions {
            grid-template-columns: 1fr;
        }
        
        .dept-info-header {
            flex-direction: column;
            gap: 1rem;
            align-items: stretch;
        }
        
        .date-controls {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .date-selector-header {
            flex-direction: column;
            align-items: stretch;
            gap: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Department Header -->
<section class="dept-header">
    <div class="container">
        <h1 class="dept-title">
            <i class="fas fa-user-tie"></i> 
            Chef de D√©partement
            <span class="dept-badge">{{ department_name }}</span>
        </h1>
        <p class="dept-subtitle">{{ user.get_full_name }} - Gestion du d√©partement {{ department_name }}</p>
    </div>
</section>

<!-- Department Navigation -->
<nav class="dept-nav">
    <div class="container">
        <div class="dept-nav-tabs">
            <a href="{% url 'department_chef_dashboard' %}" class="dept-nav-tab active">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="{% url 'department_chef_orders' %}" class="dept-nav-tab">
                <i class="fas fa-clipboard-list"></i> Production
            </a>
            <a href="{% url 'department_product_orders' %}" class="dept-nav-tab">
                <i class="fas fa-shopping-cart"></i> Commandes Produits
                {% if pending_orders > 0 %}
                <span class="nav-badge">{{ pending_orders }}</span>
                {% endif %}
            </a>
            <a href="/kitchen/department/inventory/" class="dept-nav-tab">
                <i class="fas fa-warehouse"></i> Stock
            </a>
            <a href="{% url 'kitchen_notifications' %}" class="dept-nav-tab">
                <i class="fas fa-bell"></i> Notifications
            </a>
        </div>
    </div>
</nav>

<!-- Department Content -->
<section class="dept-content">

    <div class="container">
<!-- Notifications -->
{% if notifications %}
<div class="notifications-section">
    <div class="notifications-header">
        <h3 class="notifications-title">Notifications r√©centes</h3>
        <div style="display: flex; gap: 1rem;">
            {% if unread_notifications_count > 0 %}
            <button id="mark-all-read-btn"
                    onclick="markAllAsRead()" 
                    style="background: var(--dept-gray); color: white; padding: 8px 16px; border-radius: 20px; border: none; cursor: pointer; font-weight: 600;">
                <i class="fas fa-check-double"></i> Tout marquer comme lu
            </button>
            {% endif %}
            <a href="{% url 'kitchen_notifications' %}" 
               style="background: var(--dept-accent); color: white; padding: 8px 16px; border-radius: 20px; text-decoration: none; font-weight: 600;">
                Voir tout ‚Üí
            </a>
        </div>
    </div>
    {% for notification in notifications %}
    <div class="notification-item {% if notification.is_read %}read{% endif %}" 
         data-notification-id="{{ notification.id }}"
         style="cursor: pointer; position: relative;">
        <div class="notification-icon">
            {% if notification.type == 'low_stock' %}
                <i class="fas fa-exclamation-triangle"></i>
            {% elif notification.type == 'production_delay' %}
                <i class="fas fa-clock"></i>
            {% elif notification.type == 'quality_issue' %}
                <i class="fas fa-exclamation-circle"></i>
            {% else %}
                <i class="fas fa-bell"></i>
            {% endif %}
        </div>
        <div class="notification-content">
            <div class="notification-title">{{ notification.title }}</div>
            <div class="notification-message">{{ notification.message }}</div>
            <div class="notification-time">{{ notification.created_at|timesince }} ago</div>
        </div>
        {% if not notification.is_read %}
        <div class="notification-badge" style="width: 10px; height: 10px; background: var(--dept-danger); border-radius: 50%;"></div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}
          <!-- Alertes de production du jour -->
        {% if today_production %}
            {% if today_production.status == 'in_progress' %}
            <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(255, 165, 0, 0.3); border-left: 5px solid #FF8C00;">
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 50px; height: 50px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: #8B4513;">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div>
                            <h4 style="color: #8B4513; margin: 0; font-size: 1.2rem; font-weight: 700;">Production en cours aujourd'hui !</h4>
                            <p style="color: #8B4513; margin: 0.25rem 0 0 0; font-size: 0.95rem;">{{ today_production.completed_items }}/{{ today_production.total_items }} articles termin√©s ({{ today_production.progress_percentage }}%)</p>
                        </div>
                    </div>
                    <a href="{% url 'department_chef_orders' %}?date={{ selected_date|date:'Y-m-d' }}&status=in_progress"                       style="background: #8B4513; color: white; padding: 12px 20px; border-radius: 25px; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"
                       onmouseover="this.style.background='#A0522D'; this.style.transform='translateY(-2px)'"
                       onmouseout="this.style.background='#8B4513'; this.style.transform='translateY(0)'">
                        <i class="fas fa-arrow-right"></i>
                        Voir production
                    </a>
                </div>
            </div>
            {% endif %}
            {% if today_production.status == 'not_started' and today_production.total_items > 0 %}
            <div style="background: linear-gradient(135deg, #FF6B6B 0%, #FF8E8E 100%); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3); border-left: 5px solid #DC143C;">
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 50px; height: 50px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div>
                            <h4 style="color: white; margin: 0; font-size: 1.2rem; font-weight: 700;">Production pas encore d√©marr√©e</h4>
                            <p style="color: rgba(255, 255, 255, 0.9); margin: 0.25rem 0 0 0; font-size: 0.95rem;">{{ today_production.total_items }} articles en attente de production</p>
                        </div>
                    </div>
                    <a href="{% url 'department_chef_orders' %}?date={{ selected_date|date:'Y-m-d' }}&status=in_progress" 
                       style="background: white; color: #FF6B6B; padding: 12px 20px; border-radius: 25px; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"
                       onmouseover="this.style.background='#f8f9fa'; this.style.transform='translateY(-2px)'"
                       onmouseout="this.style.background='white'; this.style.transform='translateY(0)'">
                        <i class="fas fa-play"></i>
                        D√©marrer production
                    </a>
                </div>
            </div>
            {% endif %}
            {% if today_production.status == 'completed' %}
            <div style="background: linear-gradient(135deg, #20B2AA 0%, #48D1CC 100%); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(32, 178, 170, 0.3); border-left: 5px solid #008B8B;">
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 50px; height: 50px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h4 style="color: white; margin: 0; font-size: 1.2rem; font-weight: 700;">Production termin√©e ! üéâ</h4>
                            <p style="color: rgba(255, 255, 255, 0.9); margin: 0.25rem 0 0 0; font-size: 0.95rem;">Tous les {{ today_production.total_items }} articles ont √©t√© produits</p>
                        </div>
                    </div>
                    <a href="{% url 'department_chef_orders' %}?date={{ selected_date|date:'Y-m-d' }}&status=completed" 
                       style="background: white; color: #20B2AA; padding: 12px 20px; border-radius: 25px; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"
                       onmouseover="this.style.background='#f8f9fa'; this.style.transform='translateY(-2px)'"
                       onmouseout="this.style.background='white'; this.style.transform='translateY(0)'">
                        <i class="fas fa-eye"></i>
                        Voir r√©sultats
                    </a>
                </div>
            </div>
            {% endif %}
        {% endif %}
        <!-- Date Selector -->
        <div class="date-selector-card">
            <div class="date-selector-header">
                <div class="date-selector-title">
                    <i class="fas fa-calendar-alt"></i>
                    S√©lectionner une date
                </div>
                <div class="date-controls">
                    <form method="GET" style="display: flex; align-items: center; gap: 1rem;">
                        <input type="date" 
                               name="date" 
                               value="{{ selected_date|date:'Y-m-d' }}" 
                               class="date-input"
                               onchange="this.form.submit()">
                        <a href="{% url 'department_chef_dashboard' %}" class="date-btn secondary">
                            <i class="fas fa-calendar-day"></i>
                            Aujourd'hui
                        </a>
                    </form>
                    {% if is_today %}
                        <div class="date-indicator">
                            <i class="fas fa-circle"></i>
                            Aujourd'hui
                        </div>
                    {% else %}
                        {% now "Y-m-d" as today_str %}
                        {% if selected_date|date:'Y-m-d' < today_str %}
                            <div class="date-indicator past">
                                <i class="fas fa-history"></i>
                                Pass√©
                            </div>
                        {% else %}
                            <div class="date-indicator future">
                                <i class="fas fa-clock"></i>
                                Futur
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Department Info -->
        <div class="dept-info-card">
            <div class="dept-info-header">
                <div class="dept-info-title">
                    <i class="fas fa-calendar-day"></i>
                    Production du {{ selected_date|date:"l d F Y" }}
                </div>
                <div class="today-date">
                    {{ selected_date|date:"l d F Y" }}
                </div>
            </div>
            
            {% if selected_production %}
            <!-- Production Progress -->
            <div class="production-progress" style="margin: 0;">
                <div class="progress-header">
                    <div class="progress-title">Avancement du d√©partement</div>
                    <div class="progress-percentage">{{ selected_production.progress_percentage }}%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ selected_production.progress_percentage }}%;"></div>
                </div>
                <div class="progress-details">
                    <div class="progress-item">
                        <div class="progress-item-value">{{ selected_production.total_items }}</div>
                        <div class="progress-item-label">Total articles</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-item-value">{{ selected_production.completed_items }}</div>
                        <div class="progress-item-label">Termin√©s</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-item-value">{{ selected_production.total_items|add:"-"|add:selected_production.completed_items }}</div>
                        <div class="progress-item-label">Restants</div>
                    </div>
                    <div class="progress-item">
                        <div class="progress-item-value">{{ selected_production.get_status_display }}</div>
                        <div class="progress-item-label">Statut</div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="empty-state" style="padding: 2rem 0;">
                <div class="empty-state-icon">
                    <i class="fas fa-calendar-times"></i>
                </div>
                <h4 class="empty-state-title">Aucune production ce jour</h4>
                <p class="empty-state-text">Pas de commandes √† produire pour votre d√©partement le {{ selected_date|date:"d F Y" }}.</p>
            </div>
            {% endif %}
        </div>
        
        <!-- Statistics (toujours bas√©es sur la p√©riode actuelle) -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-value">{{ dept_stats.today_progress }}%</div>
                <div class="stat-label">Progression aujourd'hui</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-list-check"></i>
                </div>
                <div class="stat-value">{{ dept_stats.today_items }}</div>
                <div class="stat-label">Articles √† produire</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-value">{{ dept_stats.week_avg_progress|floatformat:0 }}%</div>
                <div class="stat-label">Moyenne semaine</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-week"></i>
                </div>
                <div class="stat-value">{{ dept_stats.week_productions }}</div>
                <div class="stat-label">Jours actifs</div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="{% url 'department_chef_orders' %}" class="quick-action">
                <div class="quick-action-icon">
                    <i class="fas fa-utensils"></i>
                </div>
                <div class="quick-action-title">Voir production</div>
            </a>
            <a href="{% url 'department_product_orders' %}" class="quick-action">
                <div class="quick-action-icon">
                    <i class="fas fa-plus-circle"></i>
                </div>
                <div class="quick-action-title">Commander produits</div>
            </a>
            <a href="/kitchen/department/inventory/" class="quick-action">
                <div class="quick-action-icon">
                    <i class="fas fa-warehouse"></i>
                </div>
                <div class="quick-action-title">G√©rer stock</div>
            </a>
            <a href="/kitchen/print/{{ department }}/" class="quick-action">
                <div class="quick-action-icon">
                    <i class="fas fa-print"></i>
                </div>
                <div class="quick-action-title">Imprimer dispatch</div>
            </a>
            <a href="/kitchen/department/team/" class="quick-action">
                <div class="quick-action-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="quick-action-title">G√©rer √©quipe</div>
            </a>
        </div>
        
        
    </div>
  

</section>

<script>
// Fonction pour obtenir le token CSRF
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Gestion des notifications
document.addEventListener('DOMContentLoaded', function() {
    // Marquer une notification comme lue au clic
    const notificationItems = document.querySelectorAll('.notification-item');
    
    notificationItems.forEach(item => {
        item.addEventListener('click', function(e) {
            // R√©cup√©rer l'ID de la notification depuis un attribut data
            const notificationId = this.dataset.notificationId;
            
            // Si la notification n'est pas d√©j√† lue (v√©rifier si le badge existe)
            const badge = this.querySelector('.notification-badge');
            if (badge) {
                markNotificationAsRead(notificationId, this);
            }
        });
    });
    
    function markNotificationAsRead(notificationId, element) {
        // R√©cup√©rer le token CSRF depuis les cookies
        const csrfToken = getCookie('csrftoken');
        
        fetch(`/notifications/${notificationId}/read/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json',
            },
            credentials: 'same-origin'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                // Retirer l'indicateur de non-lu
                const badge = element.querySelector('.notification-badge');
                if (badge) {
                    badge.remove();
                }
                
                // Ajouter une classe pour indiquer que c'est lu
                element.classList.add('read');
                
                // Mettre √† jour le compteur de notifications dans la nav
                updateNotificationCounter();
            }
        })
        .catch(error => {
            console.error('Erreur lors du marquage de la notification:', error);
        });
    }
    
    function updateNotificationCounter() {
        // Chercher le badge dans le lien Notifications
        const notificationTab = document.querySelector('.dept-nav-tab[href*="kitchen_notifications"]');
        if (notificationTab) {
            const navBadge = notificationTab.querySelector('.nav-badge');
            if (navBadge) {
                let count = parseInt(navBadge.textContent) || 0;
                count = Math.max(0, count - 1);
                
                if (count > 0) {
                    navBadge.textContent = count;
                } else {
                    navBadge.remove();
                }
            }
        }
    }
});

// Fonction pour marquer toutes les notifications comme lues
function markAllAsRead() {
    const csrfToken = getCookie('csrftoken');
    
    fetch('/notifications/mark-all-read/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json',
        },
        credentials: 'same-origin'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            // Marquer toutes les notifications comme lues visuellement
            document.querySelectorAll('.notification-item').forEach(item => {
                item.classList.add('read');
                const badge = item.querySelector('.notification-badge');
                if (badge) badge.remove();
            });
            
            // Retirer le compteur de la navigation
            const notificationTab = document.querySelector('.dept-nav-tab[href*="kitchen_notifications"]');
            if (notificationTab) {
                const navBadge = notificationTab.querySelector('.nav-badge');
                if (navBadge) navBadge.remove();
            }
            
            // Cacher le bouton "Tout marquer comme lu"
            const markAllBtn = document.getElementById('mark-all-read-btn');
            if (markAllBtn) {
                markAllBtn.style.display = 'none';
            }
        }
    })
    .catch(error => {
        console.error('Erreur lors du marquage de toutes les notifications:', error);
    });
}

// Navigation rapide par clavier (votre code existant)
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 'ArrowLeft') {
        const currentDate = new Date('{{ selected_date|date:"Y-m-d" }}');
        currentDate.setDate(currentDate.getDate() - 1);
        const prevDay = currentDate.toISOString().split('T')[0];
        window.location.href = '?date=' + prevDay;
    } else if (e.ctrlKey && e.key === 'ArrowRight') {
        const currentDate = new Date('{{ selected_date|date:"Y-m-d" }}');
        currentDate.setDate(currentDate.getDate() + 1);
        const nextDay = currentDate.toISOString().split('T')[0];
        window.location.href = '?date=' + nextDay;
    }
});
</script>
{% endblock %}