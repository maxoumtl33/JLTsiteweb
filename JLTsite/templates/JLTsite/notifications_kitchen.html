{% extends 'JLTsite/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Notifications Cuisine - Julien-Leblanc Traiteur{% endblock %}

{% block extra_css %}
<style>
    /* Variables CSS pour chef de d√©partement */
    :root {
        --dept-primary: #4682B4;
        --dept-primary-hover: #5F9EA0;
        --dept-secondary: #B0E0E6;
        --dept-accent: #1E90FF;
        --dept-dark: #2F4F4F;
        --dept-light: #F0F8FF;
        --dept-gray: #6c757d;
        --dept-gray-light: #e9ecef;
        --dept-white: #ffffff;
        --dept-success: #20B2AA;
        --dept-warning: #FFD700;
        --dept-danger: #DC143C;
        --dept-info: #17a2b8;
    }

    /* Header */
    .dept-header {
        background: linear-gradient(135deg, var(--dept-primary) 0%, var(--dept-dark) 100%);
        padding: 2rem 0;
        position: relative;
        overflow: hidden;
    }
    
    .dept-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -10%;
        width: 60%;
        height: 200%;
        background: radial-gradient(circle, rgba(30, 144, 255, 0.1) 0%, transparent 70%);
        animation: float 20s ease-in-out infinite;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(10deg); }
    }
    
    .dept-title {
        color: white;
        font-size: 2rem;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .dept-badge {
        background: var(--dept-accent);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .dept-subtitle {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
        position: relative;
        z-index: 1;
    }
    
    /* Navigation */
    .dept-nav {
        background: var(--dept-dark);
        border-bottom: 3px solid var(--dept-accent);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    
    .dept-nav-tabs {
        display: flex;
        gap: 0;
        margin: 0;
        padding: 0;
        overflow-x: auto;
    }
    
    .dept-nav-tab {
        padding: 1rem 1.5rem;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        border-bottom: 3px solid transparent;
        position: relative;
    }
    
    .dept-nav-tab:hover {
        background: rgba(255, 255, 255, 0.05);
        color: white;
    }
    
    .dept-nav-tab.active {
        background: rgba(30, 144, 255, 0.1);
        color: var(--dept-accent);
        border-bottom-color: var(--dept-accent);
    }
    
    /* Content */
    .dept-content {
        background: var(--dept-light);
        padding: 2rem 0;
        min-height: calc(100vh - 300px);
    }
    
    /* Notifications Header */
    .notifications-header {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        border-top: 4px solid var(--dept-accent);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .notifications-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--dept-dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .notifications-count {
        background: var(--dept-danger);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    .mark-all-read {
        background: var(--dept-accent);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .mark-all-read:hover {
        background: var(--dept-primary-hover);
        transform: translateY(-2px);
    }
    
    /* Filter Bar */
    .filter-bar {
        background: white;
        border-radius: 12px;
        padding: 1rem 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .filter-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .filter-label {
        font-weight: 600;
        color: var(--dept-dark);
        font-size: 0.9rem;
    }
    
    .filter-select {
        padding: 8px 12px;
        border: 2px solid var(--dept-gray-light);
        border-radius: 6px;
        background: white;
        font-size: 0.9rem;
        min-width: 120px;
    }
    
    .filter-select:focus {
        outline: none;
        border-color: var(--dept-accent);
    }
    
    /* Notifications List */
    .notifications-container {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    
    .notification-item {
        padding: 1.5rem;
        border-bottom: 1px solid var(--dept-gray-light);
        transition: all 0.3s ease;
        position: relative;
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .notification-item:hover {
        background: var(--dept-light);
    }
    
    .notification-item:last-child {
        border-bottom: none;
    }
    
    .notification-item.unread {
        background: rgba(30, 144, 255, 0.02);
        border-left: 4px solid var(--dept-accent);
    }
    
    .notification-item.urgent {
        border-left: 4px solid var(--dept-danger);
        background: rgba(220, 20, 60, 0.02);
    }
    
    /* Notification Icon */
    .notification-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
        margin-top: 0.25rem;
    }
    
    .icon-low-stock {
        background: rgba(255, 215, 0, 0.2);
        color: var(--dept-warning);
    }
    
    .icon-production-delay {
        background: rgba(220, 20, 60, 0.2);
        color: var(--dept-danger);
    }
    
    .icon-quality-issue {
        background: rgba(255, 165, 0, 0.2);
        color: #ff8c00;
    }
    
    .icon-order-urgent {
        background: rgba(220, 20, 60, 0.2);
        color: var(--dept-danger);
    }
    
    .icon-equipment-issue {
        background: rgba(108, 117, 125, 0.2);
        color: var(--dept-gray);
    }
    
    .icon-general {
        background: rgba(30, 144, 255, 0.2);
        color: var(--dept-accent);
    }
    
    /* Notification Content */
    .notification-content {
        flex: 1;
        min-width: 0;
    }
    
    .notification-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.5rem;
    }
    
    .notification-title {
        font-weight: 600;
        color: var(--dept-dark);
        margin-bottom: 0.25rem;
        font-size: 1rem;
        line-height: 1.3;
    }
    
    .notification-time {
        font-size: 0.8rem;
        color: var(--dept-gray);
        white-space: nowrap;
        margin-left: 1rem;
    }
    
    .notification-message {
        color: var(--dept-gray);
        font-size: 0.9rem;
        line-height: 1.4;
        margin-bottom: 1rem;
    }
    
    /* Notification Meta */
    .notification-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
    }
    
    .meta-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .type-badge {
        background: var(--dept-info);
        color: white;
    }
    
    .urgent-badge {
        background: var(--dept-danger);
        color: white;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    
    .department-badge {
        background: var(--dept-accent);
        color: white;
    }
    
    /* Notification Actions */
    .notification-actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .action-btn {
        padding: 6px 12px;
        border: 2px solid;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        background: white;
    }
    
    .btn-mark-read {
        border-color: var(--dept-success);
        color: var(--dept-success);
    }
    
    .btn-mark-read:hover {
        background: var(--dept-success);
        color: white;
    }
    
    .btn-view-related {
        border-color: var(--dept-accent);
        color: var(--dept-accent);
    }
    
    .btn-view-related:hover {
        background: var(--dept-accent);
        color: white;
    }
    
    .btn-dismiss {
        border-color: var(--dept-gray);
        color: var(--dept-gray);
    }
    
    .btn-dismiss:hover {
        background: var(--dept-gray);
        color: white;
    }
    
    /* Notification Status Indicator */
    .read-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: var(--dept-accent);
        position: absolute;
        top: 1rem;
        right: 1rem;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .notification-item.unread .read-indicator {
        opacity: 1;
    }
    
    /* Related Items */
    .related-items {
        background: rgba(240, 248, 255, 0.5);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1rem;
        border-left: 4px solid var(--dept-accent);
    }
    
    .related-title {
        font-weight: 600;
        color: var(--dept-dark);
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }
    
    .related-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .related-item {
        padding: 0.25rem 0;
        font-size: 0.85rem;
        color: var(--dept-gray);
    }
    
    .related-link {
        color: var(--dept-accent);
        text-decoration: none;
        font-weight: 500;
    }
    
    .related-link:hover {
        text-decoration: underline;
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--dept-gray);
    }
    
    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
        color: var(--dept-accent);
    }
    
    .empty-state-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--dept-dark);
    }
    
    .empty-state-text {
        font-size: 1.1rem;
    }
    
    /* Quick Stats */
    .notifications-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 1.25rem;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        border-top: 4px solid var(--dept-accent);
    }
    
    .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--dept-dark);
        margin-bottom: 0.25rem;
    }
    
    .stat-label {
        color: var(--dept-gray);
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .notifications-header {
            flex-direction: column;
            gap: 1rem;
            align-items: stretch;
        }
        
        .filter-bar {
            flex-direction: column;
            align-items: stretch;
        }
        
        .filter-group {
            justify-content: space-between;
        }
        
        .notification-item {
            flex-direction: column;
            gap: 1rem;
        }
        
        .notification-header {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .notification-time {
            margin-left: 0;
        }
        
        .notification-actions {
            justify-content: center;
        }
        
        .notifications-stats {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Department Header -->
<section class="dept-header">
    <div class="container">
        <h1 class="dept-title">
            <i class="fas fa-bell"></i> 
            Notifications
            {% if unread_count > 0 %}
            <span class="dept-badge">{{ unread_count }}</span>
            {% endif %}
        </h1>
        <p class="dept-subtitle">Centre de notifications pour la cuisine</p>
    </div>
</section>

<!-- Department Navigation -->
<nav class="dept-nav">
    <div class="container">
        <div class="dept-nav-tabs">
            <a href="{% url 'department_chef_dashboard' %}" class="dept-nav-tab">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="{% url 'department_chef_orders' %}" class="dept-nav-tab">
                <i class="fas fa-clipboard-list"></i> Production
            </a>
            <a href="{% url 'department_product_orders' %}" class="dept-nav-tab">
                <i class="fas fa-shopping-cart"></i> Commandes Produits
            </a>
            <a href="/kitchen/department/inventory/" class="dept-nav-tab">
                <i class="fas fa-warehouse"></i> Stock
            </a>
            <a href="{% url 'kitchen_notifications' %}" class="dept-nav-tab active">
                <i class="fas fa-bell"></i> Notifications
            </a>
        </div>
    </div>
</nav>

<!-- Content -->
<section class="dept-content">
    <div class="container">
        <!-- Notifications Header -->
        <div class="notifications-header">
            <div class="notifications-title">
                <i class="fas fa-inbox"></i>
                Mes notifications
                {% if unread_count > 0 %}
                <span class="notifications-count">{{ unread_count }} non lues</span>
                {% endif %}
            </div>
            {% if unread_count > 0 %}
            <button class="mark-all-read" onclick="markAllAsRead()">
                <i class="fas fa-check-double"></i>
                Tout marquer comme lu
            </button>
            {% endif %}
        </div>
        
        <!-- Quick Stats -->
        <div class="notifications-stats">
            <div class="stat-card">
                <div class="stat-value">{{ total_notifications }}</div>
                <div class="stat-label">Total notifications</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ unread_count }}</div>
                <div class="stat-label">Non lues</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ urgent_count }}</div>
                <div class="stat-label">Urgentes</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ today_count }}</div>
                <div class="stat-label">Aujourd'hui</div>
            </div>
        </div>
        
        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="filter-group">
                <span class="filter-label">Statut:</span>
                <select class="filter-select" id="statusFilter" onchange="filterNotifications()">
                    <option value="all">Toutes</option>
                    <option value="unread">Non lues</option>
                    <option value="read">Lues</option>
                    <option value="urgent">Urgentes</option>
                </select>
            </div>
            
            <div class="filter-group">
                <span class="filter-label">Type:</span>
                <select class="filter-select" id="typeFilter" onchange="filterNotifications()">
                    <option value="all">Tous types</option>
                    <option value="low_stock">Stock faible</option>
                    <option value="production_delay">Retard production</option>
                    <option value="quality_issue">Probl√®me qualit√©</option>
                    <option value="order_urgent">Commande urgente</option>
                    <option value="equipment_issue">Probl√®me √©quipement</option>
                    <option value="general">G√©n√©ral</option>
                </select>
            </div>
            
            <div class="filter-group">
                <span class="filter-label">P√©riode:</span>
                <select class="filter-select" id="periodFilter" onchange="filterNotifications()">
                    <option value="all">Toutes</option>
                    <option value="today">Aujourd'hui</option>
                    <option value="week">Cette semaine</option>
                    <option value="month">Ce mois</option>
                </select>
            </div>
        </div>
        
        <!-- Notifications List -->
        <div class="notifications-container">
            {% if notifications %}
                {% for notification in notifications %}
                <div class="notification-item {% if not notification.is_read %}unread{% endif %} {% if notification.is_urgent %}urgent{% endif %}"
                     data-id="{{ notification.id }}"
                     data-status="{% if notification.is_read %}read{% else %}unread{% endif %}"
                     data-type="{{ notification.type }}"
                     data-urgent="{% if notification.is_urgent %}urgent{% endif %}"
                     data-date="{{ notification.created_at|date:'Y-m-d' }}">
                    
                    <div class="notification-icon icon-{{ notification.type }}">
                        {% if notification.type == 'low_stock' %}
                            <i class="fas fa-exclamation-triangle"></i>
                        {% elif notification.type == 'production_delay' %}
                            <i class="fas fa-clock"></i>
                        {% elif notification.type == 'quality_issue' %}
                            <i class="fas fa-exclamation-circle"></i>
                        {% elif notification.type == 'order_urgent' %}
                            <i class="fas fa-shipping-fast"></i>
                        {% elif notification.type == 'equipment_issue' %}
                            <i class="fas fa-tools"></i>
                        {% else %}
                            <i class="fas fa-bell"></i>
                        {% endif %}
                    </div>
                    
                    <div class="notification-content">
                        <div class="notification-header">
                            <div class="notification-title">{{ notification.title }}</div>
                            <div class="notification-time">{{ notification.created_at|timesince }} ago</div>
                        </div>
                        
                        <div class="notification-message">{{ notification.message }}</div>
                        
                        <div class="notification-meta">
                            <span class="meta-badge type-badge">{{ notification.get_type_display }}</span>
                            {% if notification.is_urgent %}
                            <span class="meta-badge urgent-badge">
                                <i class="fas fa-exclamation"></i> URGENT
                            </span>
                            {% endif %}
                            <span class="meta-badge department-badge">{{ notification.get_recipient_type_display }}</span>
                        </div>
                        
                        <!-- Related Items -->
                        {% if notification.production_item or notification.product_order %}
                        <div class="related-items">
                            <div class="related-title">√âl√©ments li√©s:</div>
                            <ul class="related-list">
                                {% if notification.production_item %}
                                <li class="related-item">
                                    Production: 
                                    <a href="/kitchen/production/{{ notification.production_item.id }}/" class="related-link">
                                        {{ notification.production_item.order_item.product_name }}
                                    </a>
                                </li>
                                {% endif %}
                                {% if notification.product_order %}
                                <li class="related-item">
                                    Commande: 
                                    <a href="/kitchen/product-orders/{{ notification.product_order.id }}/" class="related-link">
                                        {{ notification.product_order.order_number }}
                                    </a>
                                </li>
                                {% endif %}
                            </ul>
                        </div>
                        {% endif %}
                        
                        <div class="notification-actions">
                            {% if not notification.is_read %}
                            <button class="action-btn btn-mark-read" onclick="markAsRead({{ notification.id }})">
                                <i class="fas fa-check"></i> Marquer comme lu
                            </button>
                            {% endif %}
                            
                            {% if notification.production_item %}
                            <a href="/kitchen/production/{{ notification.production_item.id }}/" class="action-btn btn-view-related">
                                <i class="fas fa-eye"></i> Voir production
                            </a>
                            {% elif notification.product_order %}
                            <a href="/kitchen/product-orders/{{ notification.product_order.id }}/" class="action-btn btn-view-related">
                                <i class="fas fa-eye"></i> Voir commande
                            </a>
                            {% endif %}
                            
                            <button class="action-btn btn-dismiss" onclick="dismissNotification({{ notification.id }})">
                                <i class="fas fa-times"></i> Supprimer
                            </button>
                        </div>
                    </div>
                    
                    <div class="read-indicator"></div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-bell-slash"></i>
                    </div>
                    <h4 class="empty-state-title">Aucune notification</h4>
                    <p class="empty-state-text">Vous n'avez aucune notification pour le moment.</p>
                </div>
            {% endif %}
        </div>
    </div>
</section>

<script>
function filterNotifications() {
    const statusFilter = document.getElementById('statusFilter').value;
    const typeFilter = document.getElementById('typeFilter').value;
    const periodFilter = document.getElementById('periodFilter').value;
    
    const notifications = document.querySelectorAll('.notification-item');
    const today = new Date().toISOString().split('T')[0];
    const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    const monthAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    
    notifications.forEach(notification => {
        let showNotification = true;
        
        // Filter by status
        if (statusFilter !== 'all') {
            if (statusFilter === 'urgent' && !notification.dataset.urgent) {
                showNotification = false;
            } else if (statusFilter !== 'urgent' && notification.dataset.status !== statusFilter) {
                showNotification = false;
            }
        }
        
        // Filter by type
        if (typeFilter !== 'all' && notification.dataset.type !== typeFilter) {
            showNotification = false;
        }
        
        // Filter by period
        if (periodFilter !== 'all') {
            const notificationDate = notification.dataset.date;
            if (periodFilter === 'today' && notificationDate !== today) {
                showNotification = false;
            } else if (periodFilter === 'week' && notificationDate < weekAgo) {
                showNotification = false;
            } else if (periodFilter === 'month' && notificationDate < monthAgo) {
                showNotification = false;
            }
        }
        
        notification.style.display = showNotification ? 'flex' : 'none';
    });
}

function markAsRead(notificationId) {
    fetch(`/kitchen/notifications/${notificationId}/mark-read/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const notification = document.querySelector(`[data-id="${notificationId}"]`);
            notification.classList.remove('unread');
            notification.classList.add('read');
            notification.dataset.status = 'read';
            
            // Remove the mark as read button
            const markReadBtn = notification.querySelector('.btn-mark-read');
            if (markReadBtn) {
                markReadBtn.remove();
            }
            
            // Update counters
            updateNotificationCounters();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Erreur lors de la mise √† jour');
    });
}

function markAllAsRead() {
    if (confirm('Marquer toutes les notifications comme lues ?')) {
        fetch('/kitchen/notifications/mark-all-read/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Erreur lors de la mise √† jour');
        });
    }
}

function dismissNotification(notificationId) {
    if (confirm('Supprimer cette notification ?')) {
        fetch(`/kitchen/notifications/${notificationId}/dismiss/`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const notification = document.querySelector(`[data-id="${notificationId}"]`);
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    notification.remove();
                    updateNotificationCounters();
                }, 300);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Erreur lors de la suppression');
        });
    }
}

function updateNotificationCounters() {
    // Update page counters after actions
    const unreadNotifications = document.querySelectorAll('.notification-item.unread').length;
    const totalNotifications = document.querySelectorAll('.notification-item').length;
    
    // Update stats if they exist
    const statsCards = document.querySelectorAll('.stat-card .stat-value');
    if (statsCards.length >= 2) {
        statsCards[0].textContent = totalNotifications;
        statsCards[1].textContent = unreadNotifications;
    }
}

// Auto-refresh every 30 seconds for new notifications
setInterval(() => {
    fetch('/kitchen/notifications/check-new/', {
        method: 'GET',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.has_new) {
            // Show a subtle indicator that there are new notifications
            const title = document.querySelector('.notifications-title');
            if (title && !title.querySelector('.new-indicator')) {
                const indicator = document.createElement('span');
                indicator.className = 'new-indicator';
                indicator.style.cssText = 'background: var(--dept-success); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; margin-left: 0.5rem; animation: pulse 2s infinite;';
                indicator.textContent = 'NOUVEAU';
                title.appendChild(indicator);
            }
        }
    })
    .catch(error => {
        console.error('Error checking notifications:', error);
    });
}, 30000);

// CSS for fade out animation
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeOut {
        from { opacity: 1; transform: translateX(0); }
        to { opacity: 0; transform: translateX(-100%); }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}