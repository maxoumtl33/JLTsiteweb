<!-- templates/JLTsite/base_maitre_hotel.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#8e44ad">
    
    <title>{% block title %}Dashboard Maître d'hôtel{% endblock %}</title>
    
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% load static %}{% static 'images/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% load static %}{% static 'images/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% load static %}{% static 'images/favicon-16x16.png' %}">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- CSS Bootstrap et custom -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{% load static %}{% static 'manifest.json' %}">
    
    <style>
        /* Reset et base mobile */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.5;
            color: #2c3e50;
            background: #f8f9fa;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Scrollbars webkit */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(142, 68, 173, 0.5);
            border-radius: 3px;
        }
        
        /* Navigation sécurisée pour mobile */
        .safe-area-top {
            padding-top: env(safe-area-inset-top);
        }
        
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* Classes utilitaires mobile */
        .mobile-only {
            display: block;
        }
        
        .desktop-only {
            display: none;
        }
        
        @media (min-width: 768px) {
            .mobile-only {
                display: none;
            }
            
            .desktop-only {
                display: block;
            }
        }
        
        /* Prevent zoom on inputs */
        input, select, textarea {
            font-size: 16px !important;
        }
        
        /* Loading overlay global */
        .global-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(142, 68, 173, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
        }
        
        .loading-logo {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Messages Django */
        .messages {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9998;
            width: 90%;
            max-width: 400px;
        }
        
        .alert {
            border-radius: 15px;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #27ae60, #58d68d);
            color: white;
        }
        
        .alert-error,
        .alert-danger {
            background: linear-gradient(135deg, #e74c3c, #ec7063);
            color: white;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #f39c12, #f7dc6f);
            color: #2c3e50;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #3498db, #5dade2);
            color: white;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Loading global au démarrage -->
    <div id="globalLoading" class="global-loading" style="display: none;">
        <div class="loading-logo"></div>
        <h4>Chargement...</h4>
        <p>Préparation de votre espace de travail</p>
    </div>
    
    <!-- Messages Django -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Contenu principal -->
    <main>
        {% block content %}{% endblock %}
    </main>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Configuration globale pour PWA et mobile
        document.addEventListener('DOMContentLoaded', function() {
            // Enregistrer Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            }
            
            // Demander notifications
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            // Cache strategy pour images
            if ('caches' in window) {
                caches.open('maitre-hotel-v1').then(cache => {
                    // Pre-cache des assets critiques
                    cache.addAll([
                        '/static/css/bootstrap.min.css',
                        '/static/js/bootstrap.bundle.min.js',
                        '/static/images/logo.png'
                    ]).catch(err => console.log('Cache failed'));
                });
            }
            
            // Auto-hide messages après 5 secondes
            setTimeout(() => {
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    if (alert.classList.contains('show')) {
                        alert.classList.remove('show');
                        setTimeout(() => alert.remove(), 300);
                    }
                });
            }, 5000);
        });
        
        // Fonction utilitaire pour vibration
        window.vibrate = function(pattern = [50]) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        };
        
        // Fonction utilitaire pour toast
        window.showToast = function(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} position-fixed`;
            toast.style.cssText = `
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 9999;
                border-radius: 15px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: slideDown 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        };
        
        // Fonction pour loading global
        window.showGlobalLoading = function(message = 'Chargement...') {
            const loading = document.getElementById('globalLoading');
            if (loading) {
                loading.querySelector('h4').textContent = message;
                loading.style.display = 'flex';
            }
        };
        
        window.hideGlobalLoading = function() {
            const loading = document.getElementById('globalLoading');
            if (loading) {
                loading.style.display = 'none';
            }
        };
        
        // Gestion des erreurs réseau
        window.addEventListener('online', function() {
            showToast('Connexion rétablie', 'success');
        });
        
        window.addEventListener('offline', function() {
            showToast('Connexion perdue - Mode hors ligne', 'warning', 5000);
        });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>